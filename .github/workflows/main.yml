name: Ubuntu VirtualBox Android
on: workflow_dispatch

jobs:
  run-vbox:
    runs-on: ubuntu-latest
    steps:
      - name: üåê Connect Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: üõ†Ô∏è Install VirtualBox & VNC Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y virtualbox xvfb x11vnc fluxbox wmctrl

      - name: üíø Download Android ISO
        run: |
          # SourceForge is more stable for GitHub Runners
          curl -L -o android.iso "https://sourceforge.net/projects/android-x86/files/Release%209.0/android-x86_64-9.0-r2.iso/download"

      - name: üèóÔ∏è Setup VirtualBox VM
        run: |
          # 1. Create VM
          vboxmanage createvm --name "AndroidVM" --ostype "Linux26_64" --register
          vboxmanage modifyvm "AndroidVM" --memory 2048 --vram 128 --graphicscontroller vmsvga --nic1 nat
          
          # 2. Attach ISO
          vboxmanage storagectl "AndroidVM" --name "SATA" --add sata
          vboxmanage storageattach "AndroidVM" --storagectl "SATA" --port 0 --device 0 --type dvddrive --medium android.iso
          
          # 3. Enable Remote Display (VRDE)
          vboxmanage modifyvm "AndroidVM" --vrde on --vrdeport 5900 --vrdeaddress 0.0.0.0

      - name: ‚ö° Launch & Connect Info
        run: |
          # Start VirtualBox in Headless mode
          vboxmanage startvm "AndroidVM" --type headless
          
          TS_IP=$(tailscale ip -4)
          echo "=========================================="
          echo "üöÄ VIRTUALBOX STARTED"
          echo "=========================================="
          echo "  üåê IP: $TS_IP"
          echo "  üîå PORT: 5900"
          echo "  üîë PASS: (None)"
          echo "=========================================="
          echo "  IMPORTANT: Once you connect, use your"
          echo "  VNC keyboard to select 'Live CD' and"
          echo "  press ENTER. It will take 5 mins to load."
          echo "=========================================="
          
          # Keep alive for 1 hour
          sleep 3600

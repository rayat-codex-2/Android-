name: Full-Auto Android VBox
on: workflow_dispatch

jobs:
  android:
    runs-on: macos-13 # VirtualBox-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶ø‡¶á ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶∏‡ßç‡¶ü‡ßá‡¶¨‡¶≤
    steps:
      - name: üåê Connect Tailscale
        run: |
          brew install tailscale
          sudo tailscaled --tun=userspace-networking &
          sleep 5
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --hostname=gh-android-vbox

      - name: üíø Download & Setup VM
        run: |
          # ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡ßá‡¶° ISO ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
          curl -L -o android.iso "https://sourceforge.net/projects/android-x86/files/Release%209.0/android-x86_64-9.0-r2.iso/download"
          
          # ‡¶≠‡¶æ‡¶∞‡ßç‡¶ö‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
          VBoxManage createvm --name "AndroidVM" --ostype "Linux26_64" --register
          VBoxManage modifyvm "AndroidVM" --memory 4096 --vram 128 --cpus 2 --graphicscontroller vmsvga --nic1 nat
          
          # ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
          VBoxManage storagectl "AndroidVM" --name "SATA" --add sata
          VBoxManage storageattach "AndroidVM" --storagectl "SATA" --port 0 --device 0 --type dvddrive --medium android.iso
          
          # ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (android123)
          VBoxManage modifyvm "AndroidVM" --vrde on --vrdeport 5900 --vrdeaddress 0.0.0.0
          VBoxManage modifyvm "AndroidVM" --vrdeauthlibrary "VBoxAuthSimple"
          VBoxManage setextradata "AndroidVM" "VBoxInternal/Devices/VMMDev/0/Config/VBoxAuthSimple/Users/runner" $(openssl passwd -crypt android123)

      - name: ‚ö° Auto-Launch & Interaction
        run: |
          VBoxManage startvm "AndroidVM" --type headless
          
          echo "‡¶¨‡ßÅ‡¶ü ‡¶Æ‡ßá‡¶®‡ßÅ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶õ‡¶ø..."
          sleep 15
          
          # ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï 'Enter' ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ
          VBoxManage controlvm "AndroidVM" keyboardputscancode 1c 9c
          
          TS_IP=$(tailscale ip -4)
          echo "=========================================="
          echo "‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡ßá‡¶° ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá!"
          echo "üåê IP: $TS_IP"
          echo "üîå Port: 5900"
          echo "üë§ User: runner"
          echo "üîë Pass: android123"
          echo "=========================================="
          
          # ‡¶∏‡ßá‡¶∂‡¶®‡¶ü‡¶ø ‡ßß ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
          for i in {1..60}; do
            echo "‡¶¨‡ßÅ‡¶ü ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡ßü ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá... ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü: $i"
            sleep 60
          done
          

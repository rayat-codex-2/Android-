name: Final Direct Android VNC
on: workflow_dispatch

jobs:
  android:
    runs-on: macos-13 # Standard Ubuntu has no VirtualBox kernel support
    steps:
      - name: üåê Tailscale
        run: |
          brew install tailscale
          sudo tailscaled --tun=userspace-networking &
          sleep 5
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --hostname=gh-android-direct --reset

      - name: üíø Setup VM
        run: |
          curl -L -o android.iso "https://sourceforge.net/projects/android-x86/files/Release%209.0/android-x86_64-9.0-r2.iso/download"
          VBoxManage createvm --name "AndroidVM" --ostype "Linux26_64" --register
          VBoxManage modifyvm "AndroidVM" --memory 4096 --vram 128 --graphicscontroller vmsvga --nic1 nat
          VBoxManage storagectl "AndroidVM" --name "SATA" --add sata
          VBoxManage storageattach "AndroidVM" --storagectl "SATA" --port 0 --device 0 --type dvddrive --medium android.iso
          
          # DIRECT VNC CONFIG (Bypasses Ubuntu Desktop)
          VBoxManage modifyvm "AndroidVM" --vrde on --vrdeport 5900 --vrdeaddress 0.0.0.0
          VBoxManage modifyvm "AndroidVM" --vrdeauthlibrary "VBoxAuthSimple"
          VBoxManage setextradata "AndroidVM" "VBoxInternal/Devices/VMMDev/0/Config/VBoxAuthSimple/Users/runner" $(openssl passwd -crypt android123)

      - name: ‚ö° Auto-Launch
        run: |
          VBoxManage startvm "AndroidVM" --type headless
          sleep 20
          # This sends 'Enter' to select 'Live CD' automatically
          VBoxManage controlvm "AndroidVM" keyboardputscancode 1c 9c
          
          echo "=========================================="
          echo "üåê IP: $(tailscale ip -4)"
          echo "üë§ USER: runner"
          echo "üîë PASS: android123"
          echo "=========================================="
          
          for i in {1..60}; do
            echo "Keep-alive: Minute $i"
            sleep 60
          done
